<?php include '../auth.php'; ?>
<?php
if (session_status() === PHP_SESSION_NONE) session_start();

// DB ì—°ê²°
require_once '../db.php';
require_once '../../includes/config_helpers.php';

// í…Œì´ë¸”ì´ ì—†ëŠ” ê²½ìš° ìƒì„±
try {
  $pdo->query("SELECT 1 FROM " . get_table_name('site_settings') . " LIMIT 1");
} catch (PDOException $e) {
  // í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ ìƒì„±
  $sql = "CREATE TABLE " . get_table_name('site_settings') . " (
    id INT(11) NOT NULL AUTO_INCREMENT,
    setting_key VARCHAR(100) NOT NULL COMMENT 'ì„¤ì • í‚¤',
    setting_value TEXT COMMENT 'ì„¤ì • ê°’',
    setting_group VARCHAR(50) NOT NULL DEFAULT 'general' COMMENT 'ì„¤ì • ê·¸ë£¹',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ìƒì„± ì¼ì‹œ',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìˆ˜ì • ì¼ì‹œ',
    PRIMARY KEY (id),
    UNIQUE KEY setting_key (setting_key)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci";
  
  $pdo->exec($sql);
  
  // ê¸°ë³¸ ì„¤ì •ê°’ ì¶”ê°€
  $default_settings = [
    // ì¼ë°˜ ì„¤ì •
    ['site_name', 'í¬ë§ì”¨', 'general'],
    ['site_description', 'ë…¸ë™ê¶Œ ì°¾ê¸°ë¥¼ ìœ„í•œ ì •ë³´ì™€ ì§€ì›', 'general'],
    ['site_logo', '', 'general'],
    ['site_favicon', '', 'general'],
    ['admin_email', 'admin@example.com', 'general'],
    
    // í…Œë§ˆ ì„¤ì •
    ['primary_color', '#0d6efd', 'theme'],
    ['secondary_color', '#6c757d', 'theme'],
    ['success_color', '#198754', 'theme'],
    ['info_color', '#0dcaf0', 'theme'],
    ['warning_color', '#ffc107', 'theme'],
    ['danger_color', '#dc3545', 'theme'],
    ['light_color', '#f8f9fa', 'theme'],
    ['dark_color', '#212529', 'theme'],
    
    // í°íŠ¸ ì„¤ì •
    ['body_font', "'Segoe UI', sans-serif", 'font'],
    ['heading_font', "'Segoe UI', sans-serif", 'font'],
    ['font_size_base', '1rem', 'font'],
    
    // ë ˆì´ì•„ì›ƒ ì„¤ì •
    ['navbar_layout', 'fixed-top', 'layout'],
    ['sidebar_layout', 'left', 'layout'],
    ['footer_layout', 'standard', 'layout'],
    ['container_width', 'standard', 'layout'],
    
    // SNS ì„¤ì •
    ['facebook_url', '', 'social'],
    ['twitter_url', '', 'social'],
    ['instagram_url', '', 'social'],
    ['youtube_url', '', 'social'],
    ['kakaotalk_url', '', 'social'],
    
    // ê¸°íƒ€ ì„¤ì •
    ['google_analytics_id', '', 'other'],
    ['custom_css', '', 'other'],
    ['custom_js', '', 'other']
  ];
  
  $sql = "INSERT INTO " . get_table_name('site_settings') . " (setting_key, setting_value, setting_group) VALUES (?, ?, ?)";
  $stmt = $pdo->prepare($sql);
  
  foreach ($default_settings as $setting) {
    $stmt->execute($setting);
  }
}

// ì„¤ì • ê°€ì ¸ì˜¤ê¸°
function getSiteSettings($pdo, $group = null) {
  $sql = "SELECT setting_key, setting_value, setting_group FROM " . get_table_name('site_settings') . "";
  $params = [];
  
  if ($group) {
    $sql .= " WHERE setting_group = ?";
    $params[] = $group;
  }
  
  $stmt = $pdo->prepare($sql);
  $stmt->execute($params);
  $settings_data = $stmt->fetchAll(PDO::FETCH_ASSOC);
  
  $settings = [];
  foreach ($settings_data as $setting) {
    $settings[$setting['setting_key']] = $setting['setting_value'];
  }
  
  return $settings;
}

// ëª¨ë“  ì„¤ì • ê°€ì ¸ì˜¤ê¸°
$all_settings = getSiteSettings($pdo);

// ì„¤ì • ì €ì¥ ì²˜ë¦¬
$success_message = '';
$error_message = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  try {
    $pdo->beginTransaction();
    
    // ì¼ë°˜ ì„¤ì • ì €ì¥
    if (isset($_POST['save_general'])) {
      $general_settings = [
        'site_name' => isset($_POST['site_name']) ? trim($_POST['site_name']) : '',
        'site_description' => isset($_POST['site_description']) ? trim($_POST['site_description']) : '',
        'admin_email' => isset($_POST['admin_email']) ? trim($_POST['admin_email']) : ''
      ];
      
      $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = ?");
      
      foreach ($general_settings as $key => $value) {
        $stmt->execute([$value, $key]);
      }
      
      $success_message = 'ì¼ë°˜ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
      $active_tab = 'general'; // ì¼ë°˜ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
    }
    
    // í…Œë§ˆ ì„¤ì • ì €ì¥
    if (isset($_POST['save_theme'])) {
      $theme_settings = [
        'primary_color' => isset($_POST['primary_color']) ? trim($_POST['primary_color']) : '#0d6efd',
        'secondary_color' => isset($_POST['secondary_color']) ? trim($_POST['secondary_color']) : '#6c757d',
        'success_color' => isset($_POST['success_color']) ? trim($_POST['success_color']) : '#198754',
        'info_color' => isset($_POST['info_color']) ? trim($_POST['info_color']) : '#0dcaf0',
        'warning_color' => isset($_POST['warning_color']) ? trim($_POST['warning_color']) : '#ffc107',
        'danger_color' => isset($_POST['danger_color']) ? trim($_POST['danger_color']) : '#dc3545',
        'light_color' => isset($_POST['light_color']) ? trim($_POST['light_color']) : '#f8f9fa',
        'dark_color' => isset($_POST['dark_color']) ? trim($_POST['dark_color']) : '#212529'
      ];
      
      $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = ?");
      
      foreach ($theme_settings as $key => $value) {
        $result = $stmt->execute([$value, $key]);
        if (!$result) {
          throw new PDOException("Failed to update setting: $key");
        }
      }
      
      $success_message = 'í…Œë§ˆ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
      $active_tab = 'theme'; // í…Œë§ˆ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
    }
    
    // í°íŠ¸ ì„¤ì • ì €ì¥
    if (isset($_POST['save_font'])) {
      $font_settings = [
        'body_font' => isset($_POST['body_font']) ? trim($_POST['body_font']) : "'Segoe UI', sans-serif",
        'heading_font' => isset($_POST['heading_font']) ? trim($_POST['heading_font']) : "'Segoe UI', sans-serif",
        'font_size_base' => isset($_POST['font_size_base']) ? trim($_POST['font_size_base']) : '1rem'
      ];
      
      $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = ?");
      
      foreach ($font_settings as $key => $value) {
        $stmt->execute([$value, $key]);
      }
      
      $success_message = 'í°íŠ¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
      $active_tab = 'font'; // í°íŠ¸ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
    }
    
    // ë ˆì´ì•„ì›ƒ ì„¤ì • ì €ì¥
    if (isset($_POST['save_layout'])) {
      $layout_settings = [
        'navbar_layout' => isset($_POST['navbar_layout']) ? trim($_POST['navbar_layout']) : 'fixed-top',
        'sidebar_layout' => isset($_POST['sidebar_layout']) ? trim($_POST['sidebar_layout']) : 'left',
        'footer_layout' => isset($_POST['footer_layout']) ? trim($_POST['footer_layout']) : 'standard',
        'container_width' => isset($_POST['container_width']) ? trim($_POST['container_width']) : 'standard'
      ];
      
      $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = ?");
      
      foreach ($layout_settings as $key => $value) {
        $stmt->execute([$value, $key]);
      }
      
      $success_message = 'ë ˆì´ì•„ì›ƒ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
      $active_tab = 'layout'; // ë ˆì´ì•„ì›ƒ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
    }
    
    // SNS ì„¤ì • ì €ì¥
    if (isset($_POST['save_social'])) {
      $social_settings = [
        'facebook_url' => isset($_POST['facebook_url']) ? trim($_POST['facebook_url']) : '',
        'twitter_url' => isset($_POST['twitter_url']) ? trim($_POST['twitter_url']) : '',
        'instagram_url' => isset($_POST['instagram_url']) ? trim($_POST['instagram_url']) : '',
        'youtube_url' => isset($_POST['youtube_url']) ? trim($_POST['youtube_url']) : '',
        'kakaotalk_url' => isset($_POST['kakaotalk_url']) ? trim($_POST['kakaotalk_url']) : ''
      ];
      
      $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = ?");
      
      foreach ($social_settings as $key => $value) {
        $stmt->execute([$value, $key]);
      }
      
      $success_message = 'SNS ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
      $active_tab = 'social'; // SNS íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
    }
    
    // ê¸°íƒ€ ì„¤ì • ì €ì¥
    if (isset($_POST['save_other'])) {
      $other_settings = [
        'google_analytics_id' => isset($_POST['google_analytics_id']) ? trim($_POST['google_analytics_id']) : '',
        'custom_css' => isset($_POST['custom_css']) ? trim($_POST['custom_css']) : '',
        'custom_js' => isset($_POST['custom_js']) ? trim($_POST['custom_js']) : ''
      ];
      
      $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = ?");
      
      foreach ($other_settings as $key => $value) {
        $stmt->execute([$value, $key]);
      }
      
      $success_message = 'ê¸°íƒ€ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
      $active_tab = 'other'; // ê¸°íƒ€ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
    }
    
    // ë¡œê³  ì—…ë¡œë“œ ì²˜ë¦¬
    if (isset($_FILES['site_logo']) && $_FILES['site_logo']['error'] === UPLOAD_ERR_OK) {
      $upload_dir = '../../uploads/settings/';
      if (!file_exists($upload_dir)) {
        mkdir($upload_dir, 0755, true);
      }
      
      $temp_name = $_FILES['site_logo']['tmp_name'];
      $name = $_FILES['site_logo']['name'];
      $ext = strtolower(pathinfo($name, PATHINFO_EXTENSION));
      
      // ì´ë¯¸ì§€ íƒ€ì… í™•ì¸
      $allowed_types = ['jpg', 'jpeg', 'png', 'gif', 'svg'];
      if (!in_array($ext, $allowed_types)) {
        $error_message = 'ë¡œê³ ëŠ” JPG, JPEG, PNG, GIF, SVG í˜•ì‹ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.';
      } else {
        // íŒŒì¼ëª… ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ê³ ìœ í•œ íŒŒì¼ëª… ìƒì„±
        $unique_name = 'site_logo_' . uniqid() . '.' . $ext;
        $target_file = $upload_dir . $unique_name;
        
        if (move_uploaded_file($temp_name, $target_file)) {
          // ì´ì „ ë¡œê³  íŒŒì¼ ì‚­ì œ
          if (!empty($all_settings['site_logo'])) {
            $old_logo = '../../' . $all_settings['site_logo'];
            if (file_exists($old_logo)) {
              unlink($old_logo);
            }
          }
          
          $logo_path = 'uploads/settings/' . $unique_name;
          $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = 'site_logo'");
          $stmt->execute([$logo_path]);
          
          $success_message = 'ë¡œê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.';
          $active_tab = 'general'; // ì¼ë°˜ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
        } else {
          $error_message = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          $active_tab = 'general';
        }
      } else {
        $active_tab = 'general';
      }
    }
    
    // íŒŒë¹„ì½˜ ì—…ë¡œë“œ ì²˜ë¦¬
    if (isset($_FILES['site_favicon']) && $_FILES['site_favicon']['error'] === UPLOAD_ERR_OK) {
      $upload_dir = '../../uploads/settings/';
      if (!file_exists($upload_dir)) {
        mkdir($upload_dir, 0755, true);
      }
      
      $temp_name = $_FILES['site_favicon']['tmp_name'];
      $name = $_FILES['site_favicon']['name'];
      $ext = strtolower(pathinfo($name, PATHINFO_EXTENSION));
      
      // ì´ë¯¸ì§€ íƒ€ì… í™•ì¸
      $allowed_types = ['ico', 'png'];
      if (!in_array($ext, $allowed_types)) {
        $error_message = 'íŒŒë¹„ì½˜ì€ ICO, PNG í˜•ì‹ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.';
      } else {
        // íŒŒì¼ëª… ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ê³ ìœ í•œ íŒŒì¼ëª… ìƒì„±
        $unique_name = 'favicon_' . uniqid() . '.' . $ext;
        $target_file = $upload_dir . $unique_name;
        
        if (move_uploaded_file($temp_name, $target_file)) {
          // ì´ì „ íŒŒë¹„ì½˜ íŒŒì¼ ì‚­ì œ
          if (!empty($all_settings['site_favicon'])) {
            $old_favicon = '../../' . $all_settings['site_favicon'];
            if (file_exists($old_favicon)) {
              unlink($old_favicon);
            }
          }
          
          $favicon_path = 'uploads/settings/' . $unique_name;
          $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = ? WHERE setting_key = 'site_favicon'");
          $stmt->execute([$favicon_path]);
          
          $success_message = 'íŒŒë¹„ì½˜ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.';
          $active_tab = 'general'; // ì¼ë°˜ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
        } else {
          $error_message = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          $active_tab = 'general';
        }
      } else {
        $active_tab = 'general';
      }
    }
    
    // ë¡œê³  ì‚­ì œ ì²˜ë¦¬
    if (isset($_POST['delete_logo'])) {
      if (!empty($all_settings['site_logo'])) {
        $old_logo = '../../' . $all_settings['site_logo'];
        if (file_exists($old_logo)) {
          unlink($old_logo);
        }
        
        $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = '' WHERE setting_key = 'site_logo'");
        $stmt->execute();
        
        $success_message = 'ë¡œê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
        $active_tab = 'general'; // ì¼ë°˜ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
      } else {
        $active_tab = 'general';
      }
    }
    
    // íŒŒë¹„ì½˜ ì‚­ì œ ì²˜ë¦¬
    if (isset($_POST['delete_favicon'])) {
      if (!empty($all_settings['site_favicon'])) {
        $old_favicon = '../../' . $all_settings['site_favicon'];
        if (file_exists($old_favicon)) {
          unlink($old_favicon);
        }
        
        $stmt = $pdo->prepare("UPDATE " . get_table_name('site_settings') . " SET setting_value = '' WHERE setting_key = 'site_favicon'");
        $stmt->execute();
        
        $success_message = 'íŒŒë¹„ì½˜ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
        $active_tab = 'general'; // ì¼ë°˜ íƒ­ì„ í™œì„±í™” ìƒíƒœë¡œ ìœ ì§€
      } else {
        $active_tab = 'general';
      }
    }
    
    $pdo->commit();
    
    // ì„¤ì • ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
    $all_settings = getSiteSettings($pdo);
    
  } catch (PDOException $e) {
    $pdo->rollBack();
    $error_message = 'ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' . $e->getMessage();
  }
}

// í˜„ì¬ í™œì„±í™”ëœ íƒ­
$active_tab = isset($_GET['tab']) ? $_GET['tab'] : 'general';
?>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë””ìì¸ ì„¤ì • - ê´€ë¦¬ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <!-- ì»¬ëŸ¬ í”¼ì»¤ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css">
  <!-- ì½”ë“œ ì—ë””í„° -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.3/lib/codemirror.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.3/theme/dracula.min.css">
  <style>
    body {
      min-height: 100vh;
      display: flex;
      font-family: 'Segoe UI', sans-serif;
    }
    .sidebar {
      width: 220px;
      background-color: #343a40;
      color: white;
      min-height: 100vh;
    }
    .sidebar a {
      color: white;
      padding: 12px 16px;
      display: block;
      text-decoration: none;
    }
    .sidebar a:hover {
      background-color: #495057;
    }
    .main-content {
      flex-grow: 1;
      padding: 30px;
      background-color: #f8f9fa;
    }
    .sidebar .logo {
      font-weight: bold;
      font-size: 1.3rem;
      padding: 16px;
      border-bottom: 1px solid #495057;
    }
    .nav-tabs .nav-link {
      border: none;
      border-bottom: 2px solid transparent;
    }
    .nav-tabs .nav-link.active {
      border: none;
      border-bottom: 2px solid #0d6efd;
      color: #0d6efd;
    }
    .nav-tabs .nav-link:hover {
      border-color: transparent;
      border-bottom: 2px solid rgba(13, 110, 253, 0.5);
    }
    .color-picker-wrapper {
      display: flex;
      align-items: center;
    }
    .color-preview {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      margin-right: 10px;
      border: 1px solid #ced4da;
    }
    .CodeMirror {
      height: 300px;
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
    }
    .custom-preview {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #dee2e6;
      border-radius: 0.25rem;
      background-color: white;
    }
    .logo-preview, .favicon-preview {
      max-width: 200px;
      max-height: 100px;
      border: 1px solid #dee2e6;
      padding: 10px;
      border-radius: 0.25rem;
      background-color: white;
      margin-top: 10px;
    }
    .favicon-preview {
      max-width: 64px;
      max-height: 64px;
    }
  </style>
</head>
<body>

<!-- ì‚¬ì´ë“œë°” -->
<div class="sidebar">
  <div class="logo">í¬ë§ì”¨ ê´€ë¦¬ì</div>
  <a href="../index.php">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
  <a href="../posts/list.php">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</a>
  <a href="../boards/list.php">ğŸ“‹ ê²Œì‹œíŒ ê´€ë¦¬</a>
  <a href="../menu/list.php">ğŸ§­ ë©”ë‰´ ê´€ë¦¬</a>
  <a href="../inquiries/list.php">ğŸ“¬ ë¬¸ì˜ ê´€ë¦¬</a>
  <a href="../events/list.php">ğŸ“… í–‰ì‚¬ ê´€ë¦¬</a>
  <a href="../files/list.php">ğŸ“‚ ìë£Œì‹¤</a>
  <a href="site_settings.php" class="active bg-primary">ğŸ¨ ë””ìì¸ ì„¤ì •</a>
  <a href="../logout.php">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
</div>

<!-- ë³¸ë¬¸ -->
<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ë””ìì¸ ì„¤ì •</h2>
  </div>
  
  <?php if (!empty($success_message)): ?>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle-fill"></i> <?= $success_message ?>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <?php endif; ?>
  
  <?php if (!empty($error_message)): ?>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle-fill"></i> <?= $error_message ?>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <?php endif; ?>
  
  <!-- íƒ­ ë©”ë‰´ -->
  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <a class="nav-link <?= $active_tab === 'general' ? 'active' : '' ?>" href="?tab=general">ì¼ë°˜ ì„¤ì •</a>
    </li>
    <li class="nav-item">
      <a class="nav-link <?= $active_tab === 'theme' ? 'active' : '' ?>" href="?tab=theme">í…Œë§ˆ ì„¤ì •</a>
    </li>
    <li class="nav-item">
      <a class="nav-link <?= $active_tab === 'font' ? 'active' : '' ?>" href="?tab=font">í°íŠ¸ ì„¤ì •</a>
    </li>
    <li class="nav-item">
      <a class="nav-link <?= $active_tab === 'layout' ? 'active' : '' ?>" href="?tab=layout">ë ˆì´ì•„ì›ƒ ì„¤ì •</a>
    </li>
    <li class="nav-item">
      <a class="nav-link <?= $active_tab === 'social' ? 'active' : '' ?>" href="?tab=social">SNS ì„¤ì •</a>
    </li>
    <li class="nav-item">
      <a class="nav-link <?= $active_tab === 'other' ? 'active' : '' ?>" href="?tab=other">ê¸°íƒ€ ì„¤ì •</a>
    </li>
  </ul>
  
  <!-- ì¼ë°˜ ì„¤ì • íƒ­ -->
  <div class="tab-content">
    <div class="tab-pane fade <?= $active_tab === 'general' ? 'show active' : '' ?>" id="general">
      <div class="card">
        <div class="card-body">
          <form action="site_settings.php?tab=general" method="POST" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="site_name" class="form-label">ì‚¬ì´íŠ¸ ì´ë¦„</label>
              <input type="text" class="form-control" id="site_name" name="site_name" value="<?= htmlspecialchars($all_settings['site_name'] ?? '') ?>">
              <small class="form-text text-muted">ì›¹ì‚¬ì´íŠ¸ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="site_description" class="form-label">ì‚¬ì´íŠ¸ ì„¤ëª…</label>
              <textarea class="form-control" id="site_description" name="site_description" rows="2"><?= htmlspecialchars($all_settings['site_description'] ?? '') ?></textarea>
              <small class="form-text text-muted">ì›¹ì‚¬ì´íŠ¸ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="admin_email" class="form-label">ê´€ë¦¬ì ì´ë©”ì¼</label>
              <input type="email" class="form-control" id="admin_email" name="admin_email" value="<?= htmlspecialchars($all_settings['admin_email'] ?? '') ?>">
              <small class="form-text text-muted">ì‚¬ì´íŠ¸ ê´€ë¦¬ìì˜ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="site_logo" class="form-label">ì‚¬ì´íŠ¸ ë¡œê³ </label>
              
              <?php if (!empty($all_settings['site_logo'])): ?>
                <div class="mb-2">
                  <div class="logo-preview bg-light p-2 d-inline-block">
                    <img src="../../<?= htmlspecialchars($all_settings['site_logo']) ?>" alt="í˜„ì¬ ë¡œê³ " class="img-fluid">
                  </div>
                  <div class="mt-2">
                    <button type="submit" name="delete_logo" class="btn btn-sm btn-danger" onclick="return confirm('ë¡œê³ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                      <i class="bi bi-trash"></i> ë¡œê³  ì‚­ì œ
                    </button>
                  </div>
                </div>
              <?php endif; ?>
              
              <input type="file" class="form-control" id="site_logo" name="site_logo" accept="image/*">
              <small class="form-text text-muted">ë¡œê³  ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”. ê¶Œì¥ í¬ê¸°: 200x50px</small>
            </div>
            
            <div class="mb-3">
              <label for="site_favicon" class="form-label">íŒŒë¹„ì½˜</label>
              
              <?php if (!empty($all_settings['site_favicon'])): ?>
                <div class="mb-2">
                  <div class="favicon-preview bg-light p-2 d-inline-block">
                    <img src="../../<?= htmlspecialchars($all_settings['site_favicon']) ?>" alt="í˜„ì¬ íŒŒë¹„ì½˜" class="img-fluid">
                  </div>
                  <div class="mt-2">
                    <button type="submit" name="delete_favicon" class="btn btn-sm btn-danger" onclick="return confirm('íŒŒë¹„ì½˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                      <i class="bi bi-trash"></i> íŒŒë¹„ì½˜ ì‚­ì œ
                    </button>
                  </div>
                </div>
              <?php endif; ?>
              
              <input type="file" class="form-control" id="site_favicon" name="site_favicon" accept=".ico,.png">
              <small class="form-text text-muted">íŒŒë¹„ì½˜ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. (ICO ë˜ëŠ” PNG íŒŒì¼, ê¶Œì¥ í¬ê¸°: 16x16px ë˜ëŠ” 32x32px)</small>
            </div>
            
            <div class="d-flex justify-content-end">
              <button type="submit" name="save_general" class="btn btn-primary">
                <i class="bi bi-save"></i> ì €ì¥
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- í…Œë§ˆ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade <?= $active_tab === 'theme' ? 'show active' : '' ?>" id="theme">
      <div class="card">
        <div class="card-body">
          <form action="site_settings.php?tab=theme" method="POST">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="primary_color" class="form-label">ì£¼ ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['primary_color'] ?? '#0d6efd') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="primary_color" name="primary_color" value="<?= htmlspecialchars($all_settings['primary_color'] ?? '#0d6efd') ?>">
                  </div>
                  <small class="form-text text-muted">ì‚¬ì´íŠ¸ì˜ ì£¼ ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
                
                <div class="mb-3">
                  <label for="secondary_color" class="form-label">ë³´ì¡° ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['secondary_color'] ?? '#6c757d') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="secondary_color" name="secondary_color" value="<?= htmlspecialchars($all_settings['secondary_color'] ?? '#6c757d') ?>">
                  </div>
                  <small class="form-text text-muted">ì‚¬ì´íŠ¸ì˜ ë³´ì¡° ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
                
                <div class="mb-3">
                  <label for="success_color" class="form-label">ì„±ê³µ ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['success_color'] ?? '#198754') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="success_color" name="success_color" value="<?= htmlspecialchars($all_settings['success_color'] ?? '#198754') ?>">
                  </div>
                  <small class="form-text text-muted">ì„±ê³µ ë©”ì‹œì§€ ë“±ì— ì‚¬ìš©ë˜ëŠ” ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
                
                <div class="mb-3">
                  <label for="info_color" class="form-label">ì •ë³´ ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['info_color'] ?? '#0dcaf0') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="info_color" name="info_color" value="<?= htmlspecialchars($all_settings['info_color'] ?? '#0dcaf0') ?>">
                  </div>
                  <small class="form-text text-muted">ì •ë³´ ë©”ì‹œì§€ ë“±ì— ì‚¬ìš©ë˜ëŠ” ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="warning_color" class="form-label">ê²½ê³  ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['warning_color'] ?? '#ffc107') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="warning_color" name="warning_color" value="<?= htmlspecialchars($all_settings['warning_color'] ?? '#ffc107') ?>">
                  </div>
                  <small class="form-text text-muted">ê²½ê³  ë©”ì‹œì§€ ë“±ì— ì‚¬ìš©ë˜ëŠ” ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
                
                <div class="mb-3">
                  <label for="danger_color" class="form-label">ìœ„í—˜ ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['danger_color'] ?? '#dc3545') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="danger_color" name="danger_color" value="<?= htmlspecialchars($all_settings['danger_color'] ?? '#dc3545') ?>">
                  </div>
                  <small class="form-text text-muted">ìœ„í—˜ ë©”ì‹œì§€ ë“±ì— ì‚¬ìš©ë˜ëŠ” ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
                
                <div class="mb-3">
                  <label for="light_color" class="form-label">ë°ì€ ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['light_color'] ?? '#f8f9fa') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="light_color" name="light_color" value="<?= htmlspecialchars($all_settings['light_color'] ?? '#f8f9fa') ?>">
                  </div>
                  <small class="form-text text-muted">ë°ì€ ë°°ê²½ì— ì‚¬ìš©ë˜ëŠ” ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
                
                <div class="mb-3">
                  <label for="dark_color" class="form-label">ì–´ë‘ìš´ ìƒ‰ìƒ</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <div class="color-preview" style="background-color: <?= htmlspecialchars($all_settings['dark_color'] ?? '#212529') ?>;"></div>
                    </span>
                    <input type="text" class="form-control color-input" id="dark_color" name="dark_color" value="<?= htmlspecialchars($all_settings['dark_color'] ?? '#212529') ?>">
                  </div>
                  <small class="form-text text-muted">ì–´ë‘ìš´ ë°°ê²½ì— ì‚¬ìš©ë˜ëŠ” ìƒ‰ìƒì…ë‹ˆë‹¤.</small>
                </div>
              </div>
            </div>
            
            <div class="custom-preview mt-4 p-3 border rounded">
              <h5>í…Œë§ˆ ë¯¸ë¦¬ë³´ê¸°</h5>
              <div class="row g-2 mt-2">
                <div class="col-auto">
                  <button type="button" class="btn btn-primary" style="background-color: var(--primary-color); border-color: var(--primary-color);">ì£¼ ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-secondary" style="background-color: var(--secondary-color); border-color: var(--secondary-color);">ë³´ì¡° ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-success" style="background-color: var(--success-color); border-color: var(--success-color);">ì„±ê³µ ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-info" style="background-color: var(--info-color); border-color: var(--info-color);">ì •ë³´ ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-warning" style="background-color: var(--warning-color); border-color: var(--warning-color);">ê²½ê³  ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-danger" style="background-color: var(--danger-color); border-color: var(--danger-color);">ìœ„í—˜ ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-light" style="background-color: var(--light-color); border-color: var(--light-color);">ë°ì€ ìƒ‰ìƒ</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-dark" style="background-color: var(--dark-color); border-color: var(--dark-color);">ì–´ë‘ìš´ ìƒ‰ìƒ</button>
                </div>
              </div>
            </div>
            
            <div class="d-flex justify-content-end mt-3">
              <button type="submit" name="save_theme" class="btn btn-primary">
                <i class="bi bi-save"></i> ì €ì¥
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- í°íŠ¸ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade <?= $active_tab === 'font' ? 'show active' : '' ?>" id="font">
      <div class="card">
        <div class="card-body">
          <form action="site_settings.php?tab=font" method="POST">
            <div class="mb-3">
              <label for="body_font" class="form-label">ë³¸ë¬¸ í°íŠ¸</label>
              <select class="form-select" id="body_font" name="body_font">
                <option value="'Segoe UI', sans-serif" <?= ($all_settings['body_font'] ?? '') === "'Segoe UI', sans-serif" ? 'selected' : '' ?>>Segoe UI (ê¸°ë³¸)</option>
                <option value="'Malgun Gothic', sans-serif" <?= ($all_settings['body_font'] ?? '') === "'Malgun Gothic', sans-serif" ? 'selected' : '' ?>>ë§‘ì€ ê³ ë”•</option>
                <option value="'Nanum Gothic', sans-serif" <?= ($all_settings['body_font'] ?? '') === "'Nanum Gothic', sans-serif" ? 'selected' : '' ?>>ë‚˜ëˆ” ê³ ë”•</option>
                <option value="'Noto Sans KR', sans-serif" <?= ($all_settings['body_font'] ?? '') === "'Noto Sans KR', sans-serif" ? 'selected' : '' ?>>Noto Sans KR</option>
                <option value="'Roboto', sans-serif" <?= ($all_settings['body_font'] ?? '') === "'Roboto', sans-serif" ? 'selected' : '' ?>>Roboto</option>
                <option value="'Open Sans', sans-serif" <?= ($all_settings['body_font'] ?? '') === "'Open Sans', sans-serif" ? 'selected' : '' ?>>Open Sans</option>
                <option value="'Nanum Myeongjo', serif" <?= ($all_settings['body_font'] ?? '') === "'Nanum Myeongjo', serif" ? 'selected' : '' ?>>ë‚˜ëˆ” ëª…ì¡°</option>
                <option value="'Noto Serif KR', serif" <?= ($all_settings['body_font'] ?? '') === "'Noto Serif KR', serif" ? 'selected' : '' ?>>Noto Serif KR</option>
              </select>
              <small class="form-text text-muted">ë³¸ë¬¸ì— ì‚¬ìš©í•  ê¸°ë³¸ í°íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="heading_font" class="form-label">ì œëª© í°íŠ¸</label>
              <select class="form-select" id="heading_font" name="heading_font">
                <option value="'Segoe UI', sans-serif" <?= ($all_settings['heading_font'] ?? '') === "'Segoe UI', sans-serif" ? 'selected' : '' ?>>Segoe UI (ê¸°ë³¸)</option>
                <option value="'Malgun Gothic', sans-serif" <?= ($all_settings['heading_font'] ?? '') === "'Malgun Gothic', sans-serif" ? 'selected' : '' ?>>ë§‘ì€ ê³ ë”•</option>
                <option value="'Nanum Gothic', sans-serif" <?= ($all_settings['heading_font'] ?? '') === "'Nanum Gothic', sans-serif" ? 'selected' : '' ?>>ë‚˜ëˆ” ê³ ë”•</option>
                <option value="'Noto Sans KR', sans-serif" <?= ($all_settings['heading_font'] ?? '') === "'Noto Sans KR', sans-serif" ? 'selected' : '' ?>>Noto Sans KR</option>
                <option value="'Roboto', sans-serif" <?= ($all_settings['heading_font'] ?? '') === "'Roboto', sans-serif" ? 'selected' : '' ?>>Roboto</option>
                <option value="'Open Sans', sans-serif" <?= ($all_settings['heading_font'] ?? '') === "'Open Sans', sans-serif" ? 'selected' : '' ?>>Open Sans</option>
                <option value="'Nanum Myeongjo', serif" <?= ($all_settings['heading_font'] ?? '') === "'Nanum Myeongjo', serif" ? 'selected' : '' ?>>ë‚˜ëˆ” ëª…ì¡°</option>
                <option value="'Noto Serif KR', serif" <?= ($all_settings['heading_font'] ?? '') === "'Noto Serif KR', serif" ? 'selected' : '' ?>>Noto Serif KR</option>
              </select>
              <small class="form-text text-muted">ì œëª©ì— ì‚¬ìš©í•  í°íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="font_size_base" class="form-label">ê¸°ë³¸ í°íŠ¸ í¬ê¸°</label>
              <select class="form-select" id="font_size_base" name="font_size_base">
                <option value="0.875rem" <?= ($all_settings['font_size_base'] ?? '') === '0.875rem' ? 'selected' : '' ?>>ì‘ê²Œ (0.875rem)</option>
                <option value="1rem" <?= ($all_settings['font_size_base'] ?? '') === '1rem' ? 'selected' : '' ?>>ë³´í†µ (1rem)</option>
                <option value="1.125rem" <?= ($all_settings['font_size_base'] ?? '') === '1.125rem' ? 'selected' : '' ?>>í¬ê²Œ (1.125rem)</option>
                <option value="1.25rem" <?= ($all_settings['font_size_base'] ?? '') === '1.25rem' ? 'selected' : '' ?>>ì•„ì£¼ í¬ê²Œ (1.25rem)</option>
              </select>
              <small class="form-text text-muted">ì‚¬ì´íŠ¸ ì „ì²´ì— ì ìš©ë  ê¸°ë³¸ í°íŠ¸ í¬ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="custom-preview mt-4 p-3 border rounded">
              <h5>í°íŠ¸ ë¯¸ë¦¬ë³´ê¸°</h5>
              <div class="body-font-preview mt-2">
                <h3 style="font-family: var(--heading-font);">ì œëª© í°íŠ¸ ë¯¸ë¦¬ë³´ê¸°</h3>
                <p style="font-family: var(--body-font); font-size: var(--font-size-base);">ë³¸ë¬¸ í°íŠ¸ ë¯¸ë¦¬ë³´ê¸°ì…ë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ëŠ” ì„ íƒí•œ ë³¸ë¬¸ í°íŠ¸ì™€ í¬ê¸°ë¡œ í‘œì‹œë©ë‹ˆë‹¤. ì‹¤ì œ ì‚¬ì´íŠ¸ì— ì ìš©ë  í°íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                <p style="font-family: var(--body-font); font-size: var(--font-size-base);">
                  ì—¬ê¸°ì— í•œê¸€ í…ìŠ¤íŠ¸ë„ í‘œì‹œë©ë‹ˆë‹¤. ë…¸ë™ê¶Œ ì°¾ê¸°ë¥¼ ìœ„í•œ ì •ë³´ì™€ ì§€ì›ì„ ì œê³µí•˜ëŠ” í¬ë§ì”¨ ì‚¬ì´íŠ¸ì˜ í…ìŠ¤íŠ¸ í‘œì‹œ ì˜ˆì‹œì…ë‹ˆë‹¤.
                </p>
              </div>
            </div>
            
            <div class="d-flex justify-content-end mt-3">
              <button type="submit" name="save_font" class="btn btn-primary">
                <i class="bi bi-save"></i> ì €ì¥
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- ë ˆì´ì•„ì›ƒ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade <?= $active_tab === 'layout' ? 'show active' : '' ?>" id="layout">
      <div class="card">
        <div class="card-body">
          <form action="site_settings.php?tab=layout" method="POST">
            <div class="mb-3">
              <label for="navbar_layout" class="form-label">ë‚´ë¹„ê²Œì´ì…˜ ë°” ë ˆì´ì•„ì›ƒ</label>
              <select class="form-select" id="navbar_layout" name="navbar_layout">
                <option value="fixed-top" <?= ($all_settings['navbar_layout'] ?? '') === 'fixed-top' ? 'selected' : '' ?>>ìƒë‹¨ ê³ ì • (Fixed Top)</option>
                <option value="sticky-top" <?= ($all_settings['navbar_layout'] ?? '') === 'sticky-top' ? 'selected' : '' ?>>ìŠ¤í¬ë¡¤ ì‹œ ê³ ì • (Sticky Top)</option>
                <option value="static-top" <?= ($all_settings['navbar_layout'] ?? '') === 'static-top' ? 'selected' : '' ?>>ì •ì  ìƒë‹¨ (Static Top)</option>
              </select>
              <small class="form-text text-muted">ë‚´ë¹„ê²Œì´ì…˜ ë°”ì˜ ìœ„ì¹˜ ë° ë™ì‘ì„ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="sidebar_layout" class="form-label">ì‚¬ì´ë“œë°” ìœ„ì¹˜</label>
              <select class="form-select" id="sidebar_layout" name="sidebar_layout">
                <option value="left" <?= ($all_settings['sidebar_layout'] ?? '') === 'left' ? 'selected' : '' ?>>ì™¼ìª½</option>
                <option value="right" <?= ($all_settings['sidebar_layout'] ?? '') === 'right' ? 'selected' : '' ?>>ì˜¤ë¥¸ìª½</option>
                <option value="none" <?= ($all_settings['sidebar_layout'] ?? '') === 'none' ? 'selected' : '' ?>>ì—†ìŒ</option>
              </select>
              <small class="form-text text-muted">ì‚¬ì´ë“œë°”ì˜ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="footer_layout" class="form-label">í‘¸í„° ë ˆì´ì•„ì›ƒ</label>
              <select class="form-select" id="footer_layout" name="footer_layout">
                <option value="standard" <?= ($all_settings['footer_layout'] ?? '') === 'standard' ? 'selected' : '' ?>>ê¸°ë³¸</option>
                <option value="expanded" <?= ($all_settings['footer_layout'] ?? '') === 'expanded' ? 'selected' : '' ?>>í™•ì¥</option>
                <option value="minimal" <?= ($all_settings['footer_layout'] ?? '') === 'minimal' ? 'selected' : '' ?>>ìµœì†Œ</option>
              </select>
              <small class="form-text text-muted">í‘¸í„°ì˜ ë ˆì´ì•„ì›ƒì„ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="mb-3">
              <label for="container_width" class="form-label">ì»¨í…Œì´ë„ˆ ë„ˆë¹„</label>
              <select class="form-select" id="container_width" name="container_width">
                <option value="standard" <?= ($all_settings['container_width'] ?? '') === 'standard' ? 'selected' : '' ?>>ê¸°ë³¸ (ìµœëŒ€ 1140px)</option>
                <option value="fluid" <?= ($all_settings['container_width'] ?? '') === 'fluid' ? 'selected' : '' ?>>ìœ ë™ì  (100%)</option>
                <option value="narrow" <?= ($all_settings['container_width'] ?? '') === 'narrow' ? 'selected' : '' ?>>ì¢ê²Œ (ìµœëŒ€ 960px)</option>
                <option value="wide" <?= ($all_settings['container_width'] ?? '') === 'wide' ? 'selected' : '' ?>>ë„“ê²Œ (ìµœëŒ€ 1320px)</option>
              </select>
              <small class="form-text text-muted">í˜ì´ì§€ ì½˜í…ì¸ ì˜ ìµœëŒ€ ë„ˆë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</small>
            </div>
            
            <div class="d-flex justify-content-end">
              <button type="submit" name="save_layout" class="btn btn-primary">
                <i class="bi bi-save"></i> ì €ì¥
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- SNS ì„¤ì • íƒ­ -->
    <div class="tab-pane fade <?= $active_tab === 'social' ? 'show active' : '' ?>" id="social">
      <div class="card">
        <div class="card-body">
          <form action="site_settings.php?tab=social" method="POST">
            <div class="mb-3">
              <label for="facebook_url" class="form-label">
                <i class="bi bi-facebook text-primary"></i> Facebook
              </label>
              <input type="url" class="form-control" id="facebook_url" name="facebook_url" value="<?= htmlspecialchars($all_settings['facebook_url'] ?? '') ?>" placeholder="https://facebook.com/yourpage">
              <small class="form-text text-muted">Facebook í˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="mb-3">
              <label for="twitter_url" class="form-label">
                <i class="bi bi-twitter text-info"></i> Twitter / X
              </label>
              <input type="url" class="form-control" id="twitter_url" name="twitter_url" value="<?= htmlspecialchars($all_settings['twitter_url'] ?? '') ?>" placeholder="https://twitter.com/youraccount">
              <small class="form-text text-muted">Twitter / X ê³„ì • URLì„ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="mb-3">
              <label for="instagram_url" class="form-label">
                <i class="bi bi-instagram text-danger"></i> Instagram
              </label>
              <input type="url" class="form-control" id="instagram_url" name="instagram_url" value="<?= htmlspecialchars($all_settings['instagram_url'] ?? '') ?>" placeholder="https://instagram.com/youraccount">
              <small class="form-text text-muted">Instagram ê³„ì • URLì„ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="mb-3">
              <label for="youtube_url" class="form-label">
                <i class="bi bi-youtube text-danger"></i> YouTube
              </label>
              <input type="url" class="form-control" id="youtube_url" name="youtube_url" value="<?= htmlspecialchars($all_settings['youtube_url'] ?? '') ?>" placeholder="https://youtube.com/c/yourchannel">
              <small class="form-text text-muted">YouTube ì±„ë„ URLì„ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="mb-3">
              <label for="kakaotalk_url" class="form-label">
                <i class="bi bi-chat-fill text-warning"></i> ì¹´ì¹´ì˜¤í†¡ ì±„ë„
              </label>
              <input type="url" class="form-control" id="kakaotalk_url" name="kakaotalk_url" value="<?= htmlspecialchars($all_settings['kakaotalk_url'] ?? '') ?>" placeholder="https://pf.kakao.com/_xxxxxx">
              <small class="form-text text-muted">ì¹´ì¹´ì˜¤í†¡ ì±„ë„ URLì„ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="d-flex justify-content-end">
              <button type="submit" name="save_social" class="btn btn-primary">
                <i class="bi bi-save"></i> ì €ì¥
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- ê¸°íƒ€ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade <?= $active_tab === 'other' ? 'show active' : '' ?>" id="other">
      <div class="card">
        <div class="card-body">
          <form action="site_settings.php?tab=other" method="POST">
            <div class="mb-3">
              <label for="google_analytics_id" class="form-label">Google Analytics ID</label>
              <input type="text" class="form-control" id="google_analytics_id" name="google_analytics_id" value="<?= htmlspecialchars($all_settings['google_analytics_id'] ?? '') ?>" placeholder="G-XXXXXXXXXX ë˜ëŠ” UA-XXXXXXXX-X">
              <small class="form-text text-muted">Google Analytics ì¶”ì  IDë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="mb-3">
              <label for="custom_css" class="form-label">ì‚¬ìš©ì ì •ì˜ CSS</label>
              <textarea class="form-control" id="custom_css" name="custom_css" rows="8"><?= htmlspecialchars($all_settings['custom_css'] ?? '') ?></textarea>
              <small class="form-text text-muted">ì‚¬ì´íŠ¸ì— ì ìš©í•  ì¶”ê°€ CSSë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="mb-3">
              <label for="custom_js" class="form-label">ì‚¬ìš©ì ì •ì˜ JavaScript</label>
              <textarea class="form-control" id="custom_js" name="custom_js" rows="8"><?= htmlspecialchars($all_settings['custom_js'] ?? '') ?></textarea>
              <small class="form-text text-muted">ì‚¬ì´íŠ¸ì— ì ìš©í•  ì¶”ê°€ JavaScriptë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ì„ íƒì‚¬í•­)</small>
            </div>
            
            <div class="d-flex justify-content-end">
              <button type="submit" name="save_other" class="btn btn-primary">
                <i class="bi bi-save"></i> ì €ì¥
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- ì»¬ëŸ¬ í”¼ì»¤ -->
<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
<!-- ì½”ë“œ ì—ë””í„° -->
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.3/lib/codemirror.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.3/mode/css/css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.3/mode/javascript/javascript.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // íƒ­ í™œì„±í™”
  const hash = window.location.hash;
  if (hash) {
    const tab = document.querySelector('a[href="' + hash + '"]');
    if (tab) {
      tab.click();
    }
  }
  
  // ì»¬ëŸ¬ í”¼ì»¤ ì´ˆê¸°í™”
  const colorInputs = document.querySelectorAll('.color-input');
  colorInputs.forEach(function(input) {
    const pickr = Pickr.create({
      el: input.previousElementSibling.querySelector('.color-preview'),
      theme: 'classic',
      default: input.value,
      components: {
        preview: true,
        opacity: true,
        hue: true,
        interaction: {
          hex: true,
          rgba: true,
          hsla: false,
          hsva: false,
          cmyk: false,
          input: true,
          clear: false,
          save: true
        }
      }
    });
    
    pickr.on('save', (color, instance) => {
      const hexColor = color.toHEXA().toString();
      input.value = hexColor;
      input.previousElementSibling.querySelector('.color-preview').style.backgroundColor = hexColor;
      instance.hide();
      
      // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
      updateColorPreview();
    });
    
    // ì»¬ëŸ¬ í”¼ì»¤ ë³€ê²½ ì‹œì—ë„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    pickr.on('change', (color) => {
      const hexColor = color.toHEXA().toString();
      input.value = hexColor;
      input.previousElementSibling.querySelector('.color-preview').style.backgroundColor = hexColor;
      updateColorPreview();
    });
  });
  
  function updateColorPreview() {
    document.documentElement.style.setProperty('--primary-color', document.getElementById('primary_color').value);
    document.documentElement.style.setProperty('--secondary-color', document.getElementById('secondary_color').value);
    document.documentElement.style.setProperty('--success-color', document.getElementById('success_color').value);
    document.documentElement.style.setProperty('--info-color', document.getElementById('info_color').value);
    document.documentElement.style.setProperty('--warning-color', document.getElementById('warning_color').value);
    document.documentElement.style.setProperty('--danger-color', document.getElementById('danger_color').value);
    document.documentElement.style.setProperty('--light-color', document.getElementById('light_color').value);
    document.documentElement.style.setProperty('--dark-color', document.getElementById('dark_color').value);
  }
  
  // ì´ˆê¸° ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
  updateColorPreview();
  
  // í°íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
  function updateFontPreview() {
    if (document.getElementById('body_font')) {
      document.documentElement.style.setProperty('--body-font', document.getElementById('body_font').value);
    }
    if (document.getElementById('heading_font')) {
      document.documentElement.style.setProperty('--heading-font', document.getElementById('heading_font').value);
    }
    if (document.getElementById('font_size_base')) {
      document.documentElement.style.setProperty('--font-size-base', document.getElementById('font_size_base').value);
    }
  }
  
  // í°íŠ¸ ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
  if (document.getElementById('body_font')) {
    document.getElementById('body_font').addEventListener('change', updateFontPreview);
  }
  if (document.getElementById('heading_font')) {
    document.getElementById('heading_font').addEventListener('change', updateFontPreview);
  }
  if (document.getElementById('font_size_base')) {
    document.getElementById('font_size_base').addEventListener('change', updateFontPreview);
  }
  
  // ì´ˆê¸° í°íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
  updateFontPreview();
  
  // í¼ ì œì¶œ ì „ ìƒ‰ìƒ ê°’ ê²€ì¦
  const themeForm = document.querySelector('form[action*="tab=theme"]');
  if (themeForm) {
    themeForm.addEventListener('submit', function(e) {
      // ëª¨ë“  ì»¬ëŸ¬ ì¸í’‹ì˜ ê°’ì„ ë‹¤ì‹œ í•œë²ˆ í™•ì¸
      const colorInputs = themeForm.querySelectorAll('.color-input');
      let hasValidColors = true;
      
      colorInputs.forEach(input => {
        const value = input.value.trim();
        // ìƒ‰ìƒ ê°’ì´ ìœ íš¨í•œì§€ ê²€ì¦ (# + 6ìë¦¬ ë˜ëŠ” 8ìë¦¬ í—¥ìŠ¤)
        if (!value || (!value.match(/^#[0-9A-Fa-f]{6}$/) && !value.match(/^#[0-9A-Fa-f]{8}$/))) {
          console.warn('Invalid color value for', input.name, ':', value);
          // ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
          switch(input.name) {
            case 'primary_color': input.value = '#0d6efd'; break;
            case 'secondary_color': input.value = '#6c757d'; break;
            case 'success_color': input.value = '#198754'; break;
            case 'info_color': input.value = '#0dcaf0'; break;
            case 'warning_color': input.value = '#ffc107'; break;
            case 'danger_color': input.value = '#dc3545'; break;
            case 'light_color': input.value = '#f8f9fa'; break;
            case 'dark_color': input.value = '#212529'; break;
          }
        }
      });
    });
  }
  
  // ì½”ë“œ ì—ë””í„° ì´ˆê¸°í™”
  if (document.getElementById('custom_css')) {
    const cssEditor = CodeMirror.fromTextArea(document.getElementById('custom_css'), {
      mode: 'css',
      theme: 'dracula',
      lineNumbers: true,
      lineWrapping: true,
      autoCloseBrackets: true,
      matchBrackets: true
    });
  }
  
  if (document.getElementById('custom_js')) {
    const jsEditor = CodeMirror.fromTextArea(document.getElementById('custom_js'), {
      mode: 'javascript',
      theme: 'dracula',
      lineNumbers: true,
      lineWrapping: true,
      autoCloseBrackets: true,
      matchBrackets: true
    });
  }
  
  // ì•Œë¦¼ ë©”ì‹œì§€ ìë™ ì‚¬ë¼ì§€ê¸° (5ì´ˆ í›„)
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(alert => {
    setTimeout(() => {
      const bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    }, 5000);
  });
});
</script>
</body>
</html> 