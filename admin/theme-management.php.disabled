<?php include 'auth.php'; ?>
<?php
if (session_status() === PHP_SESSION_NONE) session_start();

// DB ì—°ê²° ë° ì„œë¹„ìŠ¤ ë¡œë“œ
// í…Œë§ˆ ê´€ë¦¬ í˜ì´ì§€ì—ì„œëŠ” í…Œë§ˆ ì‹œìŠ¤í…œ ë¡œë“œ ì œí•œ
$_DISABLE_THEME_LOADING = true;
require_once 'bootstrap.php';
require_once 'services/GlobalThemeIntegration.php';

$themeIntegration = new GlobalThemeIntegration($pdo);

// ë©”ì‹œì§€ ë³€ìˆ˜ ì´ˆê¸°í™”
$success_message = '';
$error_message = '';

// ìš”ì²­ ì²˜ë¦¬
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    try {
        // í™œì„± í…Œë§ˆ ë³€ê²½
        if (isset($_POST['action']) && $_POST['action'] === 'set_active_theme') {
            $themeName = $_POST['theme_name'] ?? '';
            if (!empty($themeName)) {
                $themeIntegration->setActiveTheme($themeName);
                $success_message = "í…Œë§ˆ '{$themeName}'ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
            }
        }
        
        // ìƒˆë¡œìš´ ê¸€ë¡œë²Œ í…Œë§ˆ ì¶”ê°€
        elseif (isset($_POST['action']) && $_POST['action'] === 'add_global_theme') {
            $themeName = $_POST['new_theme_name'] ?? '';
            $cssContent = $_POST['css_content'] ?? '';
            
            if (!empty($themeName) && !empty($cssContent)) {
                $themeIntegration->registerGlobalTheme($themeName, $cssContent);
                $success_message = "ê¸€ë¡œë²Œ í…Œë§ˆ '{$themeName}'ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
            } else {
                $error_message = "í…Œë§ˆëª…ê³¼ CSS ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            }
        }
        
        // CSS íŒŒì¼ ì—…ë¡œë“œë¡œ í…Œë§ˆ ì¶”ê°€
        elseif (isset($_POST['action']) && $_POST['action'] === 'upload_theme' && isset($_FILES['theme_css'])) {
            $themeName = $_POST['upload_theme_name'] ?? '';
            $uploadedFile = $_FILES['theme_css'];
            
            if (!empty($themeName) && $uploadedFile['error'] === UPLOAD_ERR_OK) {
                $cssContent = file_get_contents($uploadedFile['tmp_name']);
                $themeIntegration->registerGlobalTheme($themeName, $cssContent);
                $success_message = "í…Œë§ˆ '{$themeName}'ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.";
            } else {
                $error_message = "íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }
        
        // í…Œë§ˆ ì‚­ì œ
        elseif (isset($_POST['action']) && $_POST['action'] === 'delete_theme') {
            $themeName = $_POST['delete_theme_name'] ?? '';
            if (!empty($themeName)) {
                $themeIntegration->deleteTheme($themeName);
                $success_message = "í…Œë§ˆ '{$themeName}'ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.";
            }
        }
        
        // í…Œë§ˆ ë°±ì—…
        elseif (isset($_POST['action']) && $_POST['action'] === 'backup_themes') {
            $backupFile = $themeIntegration->backupThemes();
            $success_message = "í…Œë§ˆ ë°±ì—…ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: {$backupFile}";
        }
        
    } catch (Exception $e) {
        $error_message = $e->getMessage();
    }
}

// í…Œë§ˆ ëª©ë¡ê³¼ í†µê³„ ê°€ì ¸ì˜¤ê¸°
$allThemes = $themeIntegration->getAllThemes();
$themeStats = $themeIntegration->getThemeStats();
$activeTheme = $themeIntegration->getActiveTheme();
?>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…Œë§ˆ ê´€ë¦¬ - HOPEC ê´€ë¦¬ì</title>
    <link rel="icon" href="data:,">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* CSS ê²©ë¦¬ ë° ê°•ì œ ì ìš© */
        html, body { 
            min-height: 100vh !important; 
            display: flex !important; 
            font-family: 'Segoe UI', sans-serif !important; 
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden !important;
        }
        body * { box-sizing: border-box !important; }
        
        /* ë‹¤ë¥¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ ë¬´íš¨í™” */
        .container-fluid { display: none !important; }
        .row { display: none !important; }
        .col-md-2, .col-md-10 { display: none !important; }
        .sidebar { width: 220px; background-color: #343a40; color: white; min-height: 100vh; }
        .sidebar a { color: white; padding: 12px 16px; display: block; text-decoration: none; transition: background-color 0.2s; }
        .sidebar a:hover { background-color: #495057; }
        .sidebar a.active { background-color: #0d6efd; }
        .main-content { flex-grow: 1; padding: 30px; background-color: #f8f9fa; }
        .sidebar .logo { font-weight: bold; font-size: 1.3rem; padding: 16px; border-bottom: 1px solid #495057; }
        .table th { border-top: none; }
        
        .theme-card {
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .theme-card.active {
            border-color: #198754;
            background-color: #f8fff9;
        }
        
        .theme-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .theme-preview {
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .theme-preview.global {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .theme-preview.traditional {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .theme-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            padding: 2px 6px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .css-editor {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>

<!-- ì‚¬ì´ë“œë°” -->
<div class="sidebar">
  <div class="logo">
    <a href="<?= admin_url('index.php') ?>" class="text-white text-decoration-none">í¬ë§ì”¨ ê´€ë¦¬ì</a>
  </div>
  <a href="<?= admin_url('index.php') ?>">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
  <a href="<?= admin_url('posts/list.php') ?>">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</a>
  <a href="<?= admin_url('boards/list.php') ?>">ğŸ“‹ ê²Œì‹œíŒ ê´€ë¦¬</a>
  <a href="<?= admin_url('menu/list.php') ?>">ğŸ§­ ë©”ë‰´ ê´€ë¦¬</a>
  <a href="<?= admin_url('inquiries/list.php') ?>">ğŸ“¬ ë¬¸ì˜ ê´€ë¦¬</a>
  <a href="<?= admin_url('events/list.php') ?>">ğŸ“… í–‰ì‚¬ ê´€ë¦¬</a>
  <a href="<?= admin_url('files/list.php') ?>">ğŸ“ ìë£Œì‹¤ ê´€ë¦¬</a>
  <a href="<?= admin_url('settings/site_settings.php') ?>">ğŸ¨ ë””ìì¸ ì„¤ì •</a>
  <a href="<?= admin_url('theme-management.php') ?>" class="active">ğŸ­ í†µí•© í…Œë§ˆ ê´€ë¦¬</a>
  <a href="<?= admin_url('system/performance.php') ?>">âš¡ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</a>
  <a href="<?= admin_url('logout.php') ?>">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
</div>

<!-- ë©”ì¸ ì½˜í…ì¸  -->
<div class="main-content">
                <!-- í˜ì´ì§€ í—¤ë” -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1><i class="fas fa-palette"></i> í…Œë§ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                    <div>
                        <a href="/theme-test.php" target="_blank" class="btn btn-outline-primary">
                            <i class="fas fa-eye"></i> í…Œë§ˆ í…ŒìŠ¤íŠ¸ í˜ì´ì§€
                        </a>
                    </div>
                </div>

                <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
                <?php if (!empty($success_message)): ?>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle"></i> <?= htmlspecialchars($success_message) ?>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <?php endif; ?>

                <?php if (!empty($error_message)): ?>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-circle"></i> <?= htmlspecialchars($error_message) ?>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <?php endif; ?>

                <!-- í…Œë§ˆ í†µê³„ -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h3><?= $themeStats['total'] ?></h3>
                                <p class="mb-0">ì „ì²´ í…Œë§ˆ</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <h3><?= $themeStats['traditional'] ?></h3>
                                <p class="mb-0">ê¸°ì¡´ í…Œë§ˆ</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <h3><?= $themeStats['global'] ?></h3>
                                <p class="mb-0">ê¸€ë¡œë²Œ í…Œë§ˆ</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-white">
                            <div class="card-body text-center">
                                <h3>1</h3>
                                <p class="mb-0">í™œì„± í…Œë§ˆ</p>
                                <small><?= htmlspecialchars($activeTheme) ?></small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purpleê³¼ Red í…Œë§ˆ ìƒíƒœ í™•ì¸ -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6><i class="fas fa-info-circle"></i> Purple & Red í…Œë§ˆ ìƒíƒœ</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <?php 
                            $targetThemes = ['red', 'purple'];
                            foreach ($targetThemes as $checkTheme):
                                $isAvailable = isset($allThemes[$checkTheme]);
                                $statusColor = $isAvailable ? 'success' : 'danger';
                                $statusIcon = $isAvailable ? 'check-circle' : 'times-circle';
                                $statusText = $isAvailable ? 'ì‚¬ìš© ê°€ëŠ¥' : 'ì‚¬ìš© ë¶ˆê°€';
                            ?>
                            <div class="col-md-6">
                                <div class="alert alert-<?= $statusColor ?> mb-2">
                                    <strong><i class="fas fa-<?= $statusIcon ?>"></i> <?= ucfirst($checkTheme) ?> í…Œë§ˆ:</strong> <?= $statusText ?>
                                    <?php if ($isAvailable): ?>
                                        <br><small>íƒ€ì…: <?= $allThemes[$checkTheme]['type'] ?>, í‘œì‹œëª…: <?= $allThemes[$checkTheme]['display_name'] ?></small>
                                        <?php 
                                        $cssFile = $allThemes[$checkTheme]['css_file'];
                                        $fileExists = file_exists($cssFile);
                                        ?>
                                        <br><small>CSS íŒŒì¼: <?= $fileExists ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ' ?> (<?= $cssFile ?>)</small>
                                    <?php else: ?>
                                        <br><small>CSS íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”: /theme/globals/styles/global_<?= $checkTheme ?>.css</small>
                                    <?php endif; ?>
                                </div>
                            </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                </div>

                <!-- í…Œë§ˆ ëª©ë¡ -->
                <div id="themes" class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-list"></i> í…Œë§ˆ ëª©ë¡</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <?php foreach ($allThemes as $themeName => $theme): ?>
                                <div class="col-md-4 mb-4">
                                    <div class="card theme-card <?= $themeName === $activeTheme ? 'active' : '' ?>">
                                        <div class="theme-preview <?= $theme['type'] ?>">
                                            <span class="badge bg-secondary theme-badge">
                                                <?= ucfirst($theme['type']) ?>
                                            </span>
                                            <div class="text-center">
                                                <i class="fas fa-palette fa-2x mb-2"></i>
                                                <div><?= htmlspecialchars($theme['display_name']) ?></div>
                                            </div>
                                            <?php if ($themeName === $activeTheme): ?>
                                                <div class="position-absolute top-0 start-0 p-2">
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-check"></i> í™œì„±
                                                    </span>
                                                </div>
                                            <?php endif; ?>
                                        </div>
                                        
                                        <div class="card-body pt-0">
                                            <h6 class="card-title">
                                                <?= htmlspecialchars($theme['display_name']) ?>
                                            </h6>
                                            <p class="card-text text-muted small">
                                                <?= htmlspecialchars($theme['description']) ?>
                                            </p>
                                            <p class="card-text">
                                                <small class="text-muted">
                                                    ë²„ì „: <?= htmlspecialchars($theme['version'] ?? '1.0.0') ?> |
                                                    ì‘ì„±ì: <?= htmlspecialchars($theme['author'] ?? 'Unknown') ?>
                                                </small>
                                            </p>
                                            
                                            <div class="d-flex gap-1">
                                                <?php if ($themeName !== $activeTheme): ?>
                                                    <form method="post" class="flex-grow-1">
                                                        <input type="hidden" name="action" value="set_active_theme">
                                                        <input type="hidden" name="theme_name" value="<?= htmlspecialchars($themeName) ?>">
                                                        <button type="submit" class="btn btn-success btn-sm w-100">
                                                            <i class="fas fa-check"></i> í™œì„±í™”
                                                        </button>
                                                    </form>
                                                <?php else: ?>
                                                    <button class="btn btn-outline-success btn-sm w-100" disabled>
                                                        <i class="fas fa-check"></i> í˜„ì¬ í™œì„±
                                                    </button>
                                                <?php endif; ?>
                                                
                                                <a href="<?= htmlspecialchars($theme['preview_url']) ?>" 
                                                   target="_blank" class="btn btn-outline-primary btn-sm">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                
                                                <?php if ($theme['can_delete']): ?>
                                                    <button type="button" class="btn btn-outline-danger btn-sm" 
                                                            onclick="confirmDelete('<?= htmlspecialchars($themeName) ?>')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                <?php endif; ?>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                </div>

                <!-- ìƒˆ í…Œë§ˆ ì¶”ê°€ -->
                <div id="add-theme" class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-plus"></i> ìƒˆ í…Œë§ˆ ì¶”ê°€</h5>
                    </div>
                    <div class="card-body">
                        <!-- íƒ­ ë©”ë‰´ -->
                        <ul class="nav nav-tabs" id="addThemeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual" type="button" role="tab">
                                    <i class="fas fa-code"></i> ì§ì ‘ ì…ë ¥
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">
                                    <i class="fas fa-upload"></i> íŒŒì¼ ì—…ë¡œë“œ
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content mt-3" id="addThemeTabsContent">
                            <!-- ì§ì ‘ ì…ë ¥ íƒ­ -->
                            <div class="tab-pane fade show active" id="manual" role="tabpanel">
                                <form method="post">
                                    <input type="hidden" name="action" value="add_global_theme">
                                    
                                    <div class="mb-3">
                                        <label for="new_theme_name" class="form-label">í…Œë§ˆëª…</label>
                                        <input type="text" class="form-control" id="new_theme_name" name="new_theme_name" 
                                               placeholder="ì˜ˆ: red, purple, dark" pattern="[a-zA-Z0-9_-]+" required>
                                        <div class="form-text">ì˜ë¬¸, ìˆ«ì, í•˜ì´í”ˆ, ë°‘ì¤„ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="css_content" class="form-label">CSS ë‚´ìš©</label>
                                        <textarea class="form-control css-editor" id="css_content" name="css_content" 
                                                  rows="20" placeholder="CSS ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                                        <div class="form-text">
                                            :root ë¸”ë¡ì— CSS ë³€ìˆ˜ë¥¼ ì •ì˜í•´ì£¼ì„¸ìš”. 
                                            <a href="/theme/globals/styles/global_red.css" target="_blank">ì˜ˆì œ ë³´ê¸°</a>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> í…Œë§ˆ ì¶”ê°€
                                    </button>
                                </form>
                            </div>
                            
                            <!-- íŒŒì¼ ì—…ë¡œë“œ íƒ­ -->
                            <div class="tab-pane fade" id="upload" role="tabpanel">
                                <form method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="action" value="upload_theme">
                                    
                                    <div class="mb-3">
                                        <label for="upload_theme_name" class="form-label">í…Œë§ˆëª…</label>
                                        <input type="text" class="form-control" id="upload_theme_name" name="upload_theme_name" 
                                               placeholder="ì˜ˆ: custom, company" pattern="[a-zA-Z0-9_-]+" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="theme_css" class="form-label">CSS íŒŒì¼</label>
                                        <input type="file" class="form-control" id="theme_css" name="theme_css" 
                                               accept=".css,text/css" required>
                                        <div class="form-text">CSS íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ìµœëŒ€ 1MB)</div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-upload"></i> íŒŒì¼ ì—…ë¡œë“œ
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë°±ì—… & ë³µì› -->
                <div id="backup" class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-download"></i> ë°±ì—… & ë³µì›</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>í…Œë§ˆ ë°±ì—…</h6>
                                <p class="text-muted">ëª¨ë“  í…Œë§ˆ ì„¤ì •ì„ JSON íŒŒì¼ë¡œ ë°±ì—…í•©ë‹ˆë‹¤.</p>
                                <form method="post">
                                    <input type="hidden" name="action" value="backup_themes">
                                    <button type="submit" class="btn btn-outline-primary">
                                        <i class="fas fa-download"></i> ë°±ì—… ìƒì„±
                                    </button>
                                </form>
                            </div>
                            <div class="col-md-6">
                                <h6>í…Œë§ˆ ë³µì›</h6>
                                <p class="text-muted">ë°±ì—… íŒŒì¼ì—ì„œ í…Œë§ˆë¥¼ ë³µì›í•©ë‹ˆë‹¤. (ì¤€ë¹„ ì¤‘)</p>
                                <button class="btn btn-outline-secondary" disabled>
                                    <i class="fas fa-upload"></i> ë³µì›í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">í…Œë§ˆ ì‚­ì œ í™•ì¸</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>ì •ë§ë¡œ ì´ í…Œë§ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    <p class="text-danger"><strong>ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong></p>
                </div>
                <div class="modal-footer">
                    <form method="post" id="deleteForm">
                        <input type="hidden" name="action" value="delete_theme">
                        <input type="hidden" name="delete_theme_name" id="deleteThemeName">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-danger">ì‚­ì œ</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ê°•ë ¥í•œ ë ˆì´ì•„ì›ƒ ë³´í˜¸
        document.addEventListener('DOMContentLoaded', function() {
            const body = document.body;
            const html = document.documentElement;
            
            // í•µì‹¬ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
            function enforceLayout() {
                body.style.cssText = 'display: flex !important; min-height: 100vh !important; margin: 0 !important; padding: 0 !important; font-family: "Segoe UI", sans-serif !important; overflow-x: hidden !important;';
                html.style.cssText = 'margin: 0 !important; padding: 0 !important;';
                
                // Bootstrap ê·¸ë¦¬ë“œ ìš”ì†Œë“¤ ìˆ¨ê¸°ê¸°
                const hideElements = document.querySelectorAll('.container-fluid, .row, .col-md-2, .col-md-10');
                hideElements.forEach(el => {
                    el.style.display = 'none !important';
                });
            }
            
            // ì¦‰ì‹œ ì ìš©
            enforceLayout();
            
            // ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸ ë° ë³µì› (ë” ê°•ë ¥í•¨)
            setInterval(enforceLayout, 100);
            
            // MutationObserverë¡œ ì‹¤ì‹œê°„ ê°ì§€
            const observer = new MutationObserver(enforceLayout);
            observer.observe(body, {
                attributes: true,
                childList: true,
                subtree: true,
                attributeFilter: ['style', 'class']
            });
            observer.observe(html, {
                attributes: true,
                attributeFilter: ['style', 'class']
            });
        });
        
        function confirmDelete(themeName) {
            document.getElementById('deleteThemeName').value = themeName;
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }
        
        // CSS ì—ë””í„° ê¸°ë³¸ í…œí”Œë¦¿ ì‚½ì…
        document.getElementById('css_content').addEventListener('focus', function() {
            if (this.value.trim() === '') {
                this.value = `@custom-variant dark (&:is(.dark *));

:root {
  --font-size: 14px;
  --background: #ffffff;
  --foreground: oklch(0.145 0 0);
  --card: #ffffff;
  --card-foreground: oklch(0.145 0 0);
  --primary: #007bff;
  --primary-foreground: oklch(1 0 0);
  --secondary: #6c757d;
  --secondary-foreground: oklch(1 0 0);
  --muted: #f8f9fa;
  --muted-foreground: #6c757d;
  --accent: #e9ecef;
  --accent-foreground: #495057;
  --destructive: #dc3545;
  --destructive-foreground: #ffffff;
  --border: rgba(0, 0, 0, 0.125);
  --input: transparent;
  --input-background: #ffffff;
  --radius: 0.375rem;
}

/* ë‹¤í¬ ëª¨ë“œ */
.dark {
  --background: #1a1a1a;
  --foreground: #ffffff;
  --card: #2d2d2d;
  --card-foreground: #ffffff;
  --muted: #404040;
  --muted-foreground: #a0a0a0;
}

/* í…Œë§ˆë³„ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
@layer utilities {
  .gradient-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
  }
}`;
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì•Œë¦¼ ìë™ ë‹«ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                var alerts = document.querySelectorAll('.alert');
                alerts.forEach(function(alert) {
                    var bsAlert = new bootstrap.Alert(alert);
                    // bsAlert.close();
                });
            }, 5000);
        });
    </script>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>