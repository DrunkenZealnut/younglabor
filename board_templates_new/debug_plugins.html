<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”ŒëŸ¬ê·¸ì¸ ë¡œë”© ë””ë²„ê·¸</title>
    <style>
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            margin: 20px; 
            background: #f8fafc; 
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 4px;
        }
        .status-ok { background: #dcfce7; color: #166534; }
        .status-error { background: #fee2e2; color: #dc2626; }
        .status-loading { background: #fef3c7; color: #d97706; }
        pre { 
            background: #f1f5f9; 
            padding: 15px; 
            border-radius: 4px; 
            overflow-x: auto; 
            font-size: 12px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” í”ŒëŸ¬ê·¸ì¸ ë¡œë”© ìƒíƒœ ë””ë²„ê·¸</h1>
        
        <div id="loading-status">
            <h3>ğŸ“¦ íŒŒì¼ ë¡œë”© ìƒíƒœ</h3>
            <div id="file-status"></div>
        </div>

        <div id="css-status">
            <h3>ğŸ¨ CSS ë¡œë”© ìƒíƒœ</h3>
            <div id="css-files"></div>
        </div>

        <div id="plugin-status">
            <h3>ğŸ”Œ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ ìƒíƒœ</h3>
            <div id="plugins-list"></div>
        </div>

        <div id="toolbar-test">
            <h3>ğŸ› ï¸ íˆ´ë°” í…ŒìŠ¤íŠ¸</h3>
            <div id="summernote"></div>
        </div>

        <div id="debug-info">
            <h3>ğŸ› ë””ë²„ê·¸ ì •ë³´</h3>
            <pre id="debug-log"></pre>
        </div>
    </div>

    <!-- jQueryì™€ Summernote -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/lang/summernote-ko-KR.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css">
    
    <!-- ìš°ë¦¬ CSS -->
    <link rel="stylesheet" href="css/editor-enhancements.css">

    <script>
        $(document).ready(function() {
            var debugLog = [];
            var fileStatus = $('#file-status');
            var cssFiles = $('#css-files');
            var pluginsList = $('#plugins-list');
            var debugInfo = $('#debug-log');

            function log(message) {
                console.log(message);
                debugLog.push(new Date().toLocaleTimeString() + ': ' + message);
                debugInfo.text(debugLog.join('\\n'));
            }

            function addStatus(container, file, status, error) {
                var statusClass = status === 'ok' ? 'status-ok' : status === 'error' ? 'status-error' : 'status-loading';
                var statusText = status === 'ok' ? 'âœ… ë¡œë“œë¨' : status === 'error' ? 'âŒ ì‹¤íŒ¨' : 'â³ ë¡œë”©ì¤‘';
                
                container.append(
                    $('<div class="status-item ' + statusClass + '">')
                        .append($('<span>').text(file))
                        .append($('<span>').text(statusText + (error ? ' - ' + error : '')))
                );
            }

            log('ë””ë²„ê·¸ ì‹œì‘');

            // CSS íŒŒì¼ í™•ì¸
            var cssUrls = [
                'css/editor-enhancements.css'
            ];

            cssUrls.forEach(function(url) {
                var link = $('<link rel="stylesheet" href="' + url + '">');
                
                link.on('load', function() {
                    addStatus(cssFiles, url, 'ok');
                    log('CSS ë¡œë“œ ì„±ê³µ: ' + url);
                });
                
                link.on('error', function() {
                    addStatus(cssFiles, url, 'error', 'íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    log('CSS ë¡œë“œ ì‹¤íŒ¨: ' + url);
                });
                
                $('head').append(link);
                addStatus(cssFiles, url, 'loading');
            });

            // JavaScript íŒŒì¼ í™•ì¸
            var jsFiles = [
                'js/summernote-plugins/core/plugin-loader.js',
                'js/summernote-plugins/core/plugin-base.js',
                'js/summernote-plugins/text-styles/strikethrough.js',
                'js/summernote-plugins/text-styles/superscript.js',
                'js/summernote-plugins/text-styles/subscript.js',
                'js/summernote-plugins/text-styles/highlighter.js',
                'js/summernote-plugins/paragraph/line-height.js',
                'js/summernote-plugins/paragraph/paragraph-styles.js',
                'js/summernote-plugins/content/checklist.js',
                'js/summernote-plugins/content/divider.js',
                'js/summernote-plugins/table/table-simple.js'
            ];

            var loadedCount = 0;
            var totalFiles = jsFiles.length;

            function loadNextScript(index) {
                if (index >= jsFiles.length) {
                    setTimeout(initializeSummernote, 500);
                    return;
                }

                var url = jsFiles[index];
                addStatus(fileStatus, url, 'loading');
                
                $.getScript(url)
                    .done(function() {
                        addStatus(fileStatus, url, 'ok');
                        log('JS ë¡œë“œ ì„±ê³µ: ' + url);
                        loadedCount++;
                    })
                    .fail(function() {
                        addStatus(fileStatus, url, 'error', 'íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ');
                        log('JS ë¡œë“œ ì‹¤íŒ¨: ' + url);
                    })
                    .always(function() {
                        loadNextScript(index + 1);
                    });
            }

            loadNextScript(0);

            function initializeSummernote() {
                log('Summernote ì´ˆê¸°í™” ì‹œì‘');
                
                // í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ ìƒíƒœ í™•ì¸
                if ($.summernote && $.summernote.plugins) {
                    var plugins = $.summernote.plugins;
                    var pluginNames = [
                        'strikethrough', 'superscript', 'subscript', 'highlighter',
                        'lineHeight', 'paragraphStyles', 'checklist', 'divider', 'tableSimple'
                    ];

                    pluginNames.forEach(function(name) {
                        if (plugins[name]) {
                            addStatus(pluginsList, name, 'ok');
                            log('í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ë¨: ' + name);
                        } else {
                            addStatus(pluginsList, name, 'error', 'í”ŒëŸ¬ê·¸ì¸ì´ ë“±ë¡ë˜ì§€ ì•ŠìŒ');
                            log('í”ŒëŸ¬ê·¸ì¸ ë¯¸ë“±ë¡: ' + name);
                        }
                    });
                } else {
                    log('$.summernote.pluginsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }

                // Summernote ì´ˆê¸°í™”
                try {
                    $('#summernote').summernote({
                        height: 200,
                        lang: 'ko-KR',
                        toolbar: [
                            ['style', ['style']],
                            ['font', ['bold', 'underline', 'italic', 'strikethrough', 'superscript', 'subscript', 'clear']],
                            ['color', ['color', 'highlighter']],
                            ['para', ['ul', 'ol', 'paragraph', 'lineHeight', 'paragraphStyles']],
                            ['content', ['checklist', 'divider']],
                            ['table', ['tableSimple']],
                            ['insert', ['link']],
                            ['view', ['codeview']]
                        ],
                        callbacks: {
                            onInit: function() {
                                log('Summernote ì´ˆê¸°í™” ì™„ë£Œ');
                                
                                // íˆ´ë°” ë²„íŠ¼ í™•ì¸
                                setTimeout(function() {
                                    var toolbar = $('.note-toolbar');
                                    var buttonTypes = [
                                        'strikethrough', 'superscript', 'subscript', 'highlighter',
                                        'line-height', 'paragraph-styles', 'checklist', 'divider', 'table-simple'
                                    ];

                                    buttonTypes.forEach(function(type) {
                                        var button = toolbar.find('.note-btn-' + type);
                                        if (button.length > 0) {
                                            log('íˆ´ë°” ë²„íŠ¼ ë°œê²¬: ' + type);
                                        } else {
                                            log('íˆ´ë°” ë²„íŠ¼ ì—†ìŒ: ' + type);
                                        }
                                    });

                                    // ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ í™•ì¸
                                    var dropdowns = toolbar.find('.dropdown-toggle');
                                    log('ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ ê°œìˆ˜: ' + dropdowns.length);
                                    
                                    dropdowns.each(function(i, btn) {
                                        var $btn = $(btn);
                                        var hasCustomCaret = $btn.find('.note-icon-caret').length > 0;
                                        var computedAfter = window.getComputedStyle(btn, '::after');
                                        var hasAfterContent = computedAfter.content !== 'none' && computedAfter.content !== '""';
                                        
                                        log('ë“œë¡­ë‹¤ìš´ ' + (i+1) + ': ì»¤ìŠ¤í…€í™”ì‚´í‘œ=' + hasCustomCaret + ', CSSí™”ì‚´í‘œ=' + hasAfterContent);
                                    });
                                }, 1000);
                            },
                            onError: function(e) {
                                log('Summernote ì˜¤ë¥˜: ' + e);
                            }
                        }
                    });
                } catch (e) {
                    log('Summernote ì´ˆê¸°í™” ì‹¤íŒ¨: ' + e.message);
                }
            }

            log('ë””ë²„ê·¸ ë„êµ¬ ë¡œë“œ ì™„ë£Œ');
        });
    </script>
</body>
</html>